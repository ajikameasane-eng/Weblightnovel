<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Asane CMS v3 â€” ÄÄƒng truyá»‡n</title>
  <style>
    body {
      font-family: sans-serif;
      background: #fff;
      color: #000;
      margin: 2rem;
    }
    input, textarea, button {
      width: 100%;
      margin: 0.5rem 0;
      padding: 0.5rem;
      border: 1px solid #000;
      background: #fafafa;
    }
    button {
      cursor: pointer;
      font-weight: bold;
      background: #fff;
    }
  </style>
</head>
<body>
  <h1>ğŸ“ ÄÄƒng truyá»‡n má»›i</h1>
  <input id="title" placeholder="TiÃªu Ä‘á» truyá»‡n" />
  <input id="author" placeholder="TÃ¡c giáº£ (tuá»³ chá»n)" />
  <textarea id="desc" rows="3" placeholder="MÃ´ táº£ ngáº¯n..."></textarea>
  <input id="cover" type="file" accept="image/*" />
  <textarea id="content" rows="8" placeholder="Ná»™i dung truyá»‡n..."></textarea>
  <button onclick="uploadStory()">ğŸ“¤ ÄÄƒng truyá»‡n</button>

  <script>
    async function uploadStory() {
      const title = document.getElementById('title').value.trim();
      const author = document.getElementById('author').value.trim();
      const desc = document.getElementById('desc').value.trim();
      const content = document.getElementById('content').value.trim();
      const coverFile = document.getElementById('cover').files[0];

      if (!title || !content) return alert('âš ï¸ Vui lÃ²ng nháº­p Ä‘á»§ tiÃªu Ä‘á» vÃ  ná»™i dung.');

      let cover = '';
      if (coverFile) {
        const reader = new FileReader();
        cover = await new Promise(resolve => {
          reader.onload = e => resolve(e.target.result);
          reader.readAsDataURL(coverFile);
        });
      }

      const story = {
        title,
        author,
        desc,
        content,
        cover,
        date: new Date().toISOString()
      };

      const fileName = `stories/${title.replace(/\s+/g, '_')}.json`;

      // âš ï¸ HÆ°á»›ng dáº«n: DÃ¡n token cá»§a cáº­u vÃ o khi cháº¡y local, KHÃ”NG commit lÃªn repo!
      const token = prompt("DÃ¡n GitHub Token cá»§a báº¡n táº¡i Ä‘Ã¢y:");

      const response = await fetch(`https://api.github.com/repos/ajikameasane-eng/Weblightnovel/contents/${fileName}`, {
        method: "PUT",
        headers: {
          "Authorization": `Bearer ${token}`,
          "Content-Type": "application/json",
        },
        body: JSON.stringify({
          message: `Add story: ${title}`,
          content: btoa(JSON.stringify(story, null, 2))
        })
      });

      if (response.ok) {
        alert("âœ… Truyá»‡n Ä‘Ã£ Ä‘Æ°á»£c Ä‘Äƒng thÃ nh cÃ´ng lÃªn GitHub!");
        document.querySelectorAll('input, textarea').forEach(e => e.value = '');
      } else {
        const error = await response.json();
        alert("âŒ Lá»—i khi Ä‘Äƒng truyá»‡n: " + (error.message || 'KhÃ´ng rÃµ lá»—i.'));
      }
    }
  </script>
</body>
</html>
